## División Regional de Datos {#sec-regional-split}

El conjunto de datos se dividió por las tres zonas biogeográficas (Girona, Barcelona y Tarragona) basándose en los rangos de identificadores de playa para facilitar análisis regionales comparativos.

```{r}
#| label: load-packages-chapter2
#| echo: false
#| eval: true
#| output: false
library(tidyverse)
conflicted::conflict_prefer("filter", "dplyr")
conflicted::conflict_prefer("select", "dplyr")
source("../R/global_config.R")
```

### Procesamiento y División de Datos

```{r}
#| label: load-data-chapter2
#| echo: false
#| eval: true
#| output: false
load("../data/processed_data_clean.RData")
str(main_data, max.level = 1)
```

```{r}
#| label: select-columns-chapter2
#| echo: false
#| eval: true
#| output: false
main_data_selected <- main_data %>%
  select(plot, id_beach, 8:ncol(main_data))
```

```{r}
#| label: split-by-region
#| echo: false
#| eval: true
#| output: false
beaches_by_region <- list()
beaches_by_region[["Girona"]] <- main_data_selected %>% filter(id_beach >= 1 & id_beach <= 19)
beaches_by_region[["Barcelona"]] <- main_data_selected %>% filter(id_beach >= 20 & id_beach <= 23)
beaches_by_region[["Tarragona"]] <- main_data_selected %>% filter(id_beach >= 24)
```

Los rangos utilizados fueron: Girona (IDs 1-19), Barcelona (IDs 20-23), y Tarragona (IDs 24 y superiores).

```{r}
#| label: validate-split
#| echo: false
#| eval: true
#| output: false
cat("Número de observaciones por región:\n")
cat("Girona:", nrow(beaches_by_region[["Girona"]]), "observaciones\n")
cat("Barcelona:", nrow(beaches_by_region[["Barcelona"]]), "observaciones\n")
cat("Tarragona:", nrow(beaches_by_region[["Tarragona"]]), "observaciones\n")

total_observations <- sum(sapply(beaches_by_region, nrow))
cat("\nTotal de observaciones en todas las regiones:", total_observations, "\n")
cat("Observaciones del conjunto de datos original:", nrow(main_data_selected), "\n")

if(total_observations == nrow(main_data_selected)) {
  cat("Validación exitosa: Todas las observaciones han sido asignadas a una región.\n")
} else {
  cat("Validación fallida: La suma de observaciones regionales no coincide con el conjunto de datos original.\n")
}
```

```{r}
#| label: fig-regional-distribution
#| fig-cap: "Distribución de observaciones por región"
#| echo: false
#| eval: true
#| output: true

region_counts <- data.frame(
  Region = names(beaches_by_region),
  Observations = sapply(beaches_by_region, nrow)
)

region_counts <- order_provinces(region_counts)

ggplot(region_counts, aes(x = Region, y = Observations, fill = Region)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Observations), vjust = -0.5) +
  theme_minimal() +
  labs(
    title = "Distribución de Observaciones por Región",
    x = "Región",
    y = "Número de Observaciones"
  ) +
  scale_fill_manual(values = PROVINCE_COLORS) +
  coord_cartesian(clip = "off") +
  theme(plot.margin = margin(t = 20, r = 10, b = 10, l = 10, unit = "pt"))
```

```{r}
#| label: save-regional-data
#| echo: false
#| eval: true
#| output: false
save(beaches_by_region, file = "../data/all_observations_split.RData")
cat("Conjuntos de datos regionales guardados en 'data/all_observations_split.RData'\n")
```

Los conjuntos de datos regionales resultantes se guardaron para su uso en análisis posteriores que exploren variaciones regionales en patrones de vegetación dunar y prácticas de gestión.
